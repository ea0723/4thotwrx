{"filter":false,"title":"conversion.rb","tooltip":"/app/models/conversion.rb","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":17},"end":{"row":2,"column":18}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":18},"end":{"row":2,"column":19}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":19},"end":{"row":2,"column":20}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":20},"end":{"row":2,"column":21}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":21},"end":{"row":2,"column":22}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":22},"end":{"row":2,"column":23}},"text":"_"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":23},"end":{"row":2,"column":24}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":24},"end":{"row":2,"column":25}},"text":"f"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":25},"end":{"row":2,"column":26}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":26}},"text":"validates_presence_of "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":3,"column":0},"end":{"row":3,"column":4}},"text":"    "},{"action":"removeLines","range":{"start":{"row":2,"column":0},"end":{"row":3,"column":0}},"nl":"\n","lines":["    "]},{"action":"removeText","range":{"start":{"row":1,"column":4},"end":{"row":2,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":1,"column":4},"end":{"row":2,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":2,"column":0},"end":{"row":2,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":4},"end":{"row":3,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":3,"column":0},"end":{"row":3,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":114}},"text":"validates :convert_me => !include(\"glob glob glob glob\" || \"prok prok\" ||\"pish pish pish pish\" || \"tegj tegj\")"},{"action":"insertText","range":{"start":{"row":2,"column":114},"end":{"row":3,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":3,"column":0},"end":{"row":3,"column":35}},"text":"  validates_presence_of :convert_me"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":0},"end":{"row":2,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":1,"column":4},"end":{"row":2,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":1,"column":4},"end":{"row":2,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":2,"column":0},"end":{"row":2,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":3,"column":2},"end":{"row":3,"column":4}},"text":"  "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":13},"end":{"row":2,"column":14}},"text":"_"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":14},"end":{"row":2,"column":15}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":15},"end":{"row":2,"column":16}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":16},"end":{"row":2,"column":17}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":17},"end":{"row":2,"column":18}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":18},"end":{"row":2,"column":19}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":19},"end":{"row":2,"column":20}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":20},"end":{"row":2,"column":21}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":21},"end":{"row":2,"column":22}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":21},"end":{"row":2,"column":22}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":20},"end":{"row":2,"column":21}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":19},"end":{"row":2,"column":20}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":19},"end":{"row":2,"column":20}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":20},"end":{"row":2,"column":21}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":20},"end":{"row":2,"column":21}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":19},"end":{"row":2,"column":20}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":19},"end":{"row":2,"column":20}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":20},"end":{"row":2,"column":21}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":21}},"text":"validates_include"},{"action":"insertText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":5}},"text":"v"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":5},"end":{"row":2,"column":6}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":6},"end":{"row":2,"column":7}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":7},"end":{"row":2,"column":8}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":8},"end":{"row":2,"column":9}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":9},"end":{"row":2,"column":10}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":10},"end":{"row":2,"column":11}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":11},"end":{"row":2,"column":12}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":12},"end":{"row":2,"column":13}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":12},"end":{"row":2,"column":13}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":11},"end":{"row":2,"column":12}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":10},"end":{"row":2,"column":11}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":9},"end":{"row":2,"column":10}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":8},"end":{"row":2,"column":9}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":7},"end":{"row":2,"column":8}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":6},"end":{"row":2,"column":7}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":5},"end":{"row":2,"column":6}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":5}},"text":"v"},{"action":"insertText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":59}},"text":"validates_inclusion_of :attribute, :in => %w( mov avi )"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":38}},"text":"validates_inclusion_of :attribute,"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":26}},"text":" :in => %w( mov avi ) "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":5}},"text":"v"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":5}},"text":"v"},{"action":"insertText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":59}},"text":"validates_exclusion_of :attribute, :in => %w( mov avi )"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":46},"end":{"row":2,"column":59}},"text":"%w( mov avi )"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":58},"end":{"row":2,"column":60}},"text":"=>"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":58},"end":{"row":2,"column":60}},"text":" !"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":58},"end":{"row":2,"column":65}},"text":"include"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":58},"end":{"row":2,"column":135}},"text":"(\"glob glob glob glob\" || \"prok prok\" ||\"pish pish pish pish\" || \"tegj tegj\")"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":27},"end":{"row":2,"column":37}},"text":":attribute"},{"action":"insertText","range":{"start":{"row":2,"column":27},"end":{"row":2,"column":29}},"text":"()"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":28},"end":{"row":2,"column":29}},"text":")"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":27},"end":{"row":2,"column":28}},"text":"("}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":27},"end":{"row":2,"column":104}},"text":"(\"glob glob glob glob\" || \"prok prok\" ||\"pish pish pish pish\" || \"tegj tegj\")"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":124},"end":{"row":2,"column":125}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":1,"column":4},"end":{"row":2,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":2,"column":0},"end":{"row":2,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":5}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":5},"end":{"row":2,"column":6}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":6},"end":{"row":2,"column":7}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":7},"end":{"row":2,"column":8}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":7},"end":{"row":2,"column":8}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":6},"end":{"row":2,"column":7}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":5},"end":{"row":2,"column":6}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":5}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":5}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":5},"end":{"row":2,"column":6}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":5},"end":{"row":2,"column":6}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":5},"end":{"row":2,"column":6}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":5},"end":{"row":2,"column":6}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":5}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":2,"column":0},"end":{"row":2,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":1,"column":4},"end":{"row":2,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":2,"column":4},"end":{"row":2,"column":6}},"text":"# "},{"action":"insertText","range":{"start":{"row":3,"column":4},"end":{"row":3,"column":6}},"text":"# "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":4,"column":0},"end":{"row":4,"column":3}},"text":"   "},{"action":"removeLines","range":{"start":{"row":3,"column":0},"end":{"row":4,"column":0}},"nl":"\n","lines":["    # validates_presence_of :convert_me"]},{"action":"removeText","range":{"start":{"row":2,"column":3},"end":{"row":2,"column":126}},"text":" # validates_exclusion_of (\"glob glob glob glob\" || \"prok prok\" ||\"pish pish pish pish\" || \"tegj tegj\"), :in => :convert_me"},{"action":"removeText","range":{"start":{"row":2,"column":3},"end":{"row":3,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":0,"column":0},"end":{"row":4,"column":0}},"nl":"\n","lines":["class Conversion < ActiveRecord::Base","    ","    ","end"]},{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":37}},"text":"class Conversion < ActiveRecord::Base"},{"action":"insertText","range":{"start":{"row":0,"column":37},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":1,"column":0},"end":{"row":109,"column":0}},"lines":["","  validates_presence_of :convert_me, presence: true, length: { maximum: 100 }","  validate :input_valid","  validate :clean_it_up","  before_create :map_it","  before_create :calculate_it","","# Step 1) validate that the input contains nothing outside the accepted input to nullify calculation if not necessary","","  @valid_words = Regexp.union(/glob|prok|pish|tegj|how much is|how many credits is|\\sis\\s\\d+\\scredits\\z|\\bI\\b|\\bV\\b|\\bX\\b|\\bL\\b/i)","  @units = []","  @metals = 1","","  def input_valid","    self.convert_me do","      unless self.convert_me.scan(@valid_words)","        errors.add(:convert_me, 'I have no idea what you are talking about')","      end","    end","  end","","# Step2) clean up the string for conversion","","  # start by remove any ending spaces and punctuation","  def clean_it_up","    self.convert_me.downcase!","    if self.convert_me.match(/\\?\\s*$/)","      self.convert_me.chop!","      puts(\"here's the string --> #{convert_me}\")","    end","    # next, remove any leading or tailing strings","    if self.convert_me.scan(/\\A(how many credits is\\s)/i)","      self.convert_me.gsub!(/\\A(how many credits is\\s)/i, '')","      puts(\"here's the simplified string for splitting --> #{convert_me}\")","    end","    if self.convert_me.scan(/\\A(how much is\\s)/i)","      self.convert_me.gsub!(/\\A(how much is\\s)/i, '')","      puts(\"here's the simplified string for splitting --> #{convert_me}\")","    end","    if self.convert_me.scan(/(is \\d+ credits)\\z/i)","      self.convert_me.gsub!(/(is \\d+ credits)\\z/i, '')","      puts(\"here's the simplified string for splitting --> #{convert_me}\")","    end","    if self.convert_me.match(/\\A(glob is I)|(prok is V)|(pish is X)|(tegj is L)/i)","      self.convert_me.gsub!(/\\A\\sis\\s./i, '')","      puts(\"here's the simplified string for splitting --> #{convert_me}\")","    end","    # finally, convert input string to an array","    @units = convert_me.split(\" \")","    puts(\"Here's the split string --> #{@units}\")","  end","","","# Step 3) strip any leading words if they got through step 2. Map the units to Roman Numerals or integer for ease of assessment. Break out the metals. Convert to integers","  def map_it","    if @units[1] == 'is' then @units.pop(2)","    end","    @units.map! { |a|","      if a == 'glob' then a = 'I'","      elsif a == 'prok' then a = 'V'","      elsif a == 'pish' then a = 'X'","      elsif a == 'tegj' then a = 'L'","      elsif a == 'gold' then a = 14450","      elsif a == 'iron' then a = 195.50","      elsif a == 'silver' then a = 17","      # return an error as a backup if anything got through the validation","      else","        self.credits = 'I have no idea what you are talking about'","      end","    }","    # separate out the \"metals\" for multiplication","    @units.length <= 1 || @units[-1].is_a?(String) ? @metals = 1 : @metals = @units.pop","      puts(\"this is the metals --> #{@metals}\")","    @joined = @units.join('')","      puts(\"this is the joined array --> #{@joined}\")","  end","","  def calculate_it","    @total = 0","    @add = 0","      puts(\"this is the starting total --> #{@total}\")","  # convert units from roman numerals to integers & multiply by metals to get final credit amount. Raise exception if invalid numeral pair","    if self.credits == nil","      until @joined.empty? do","        case","          when @joined.start_with?('L') then @add += 50; len = 1","          when @joined.start_with?('XL') then @add += 40; len = 2","          when @joined.start_with?('X') then @add += 10; len = 1","          when @joined.start_with?('IX') then @add += 9; len = 2","          when @joined.start_with?('V') then @add += 5; len = 1","          when @joined.start_with?('IV') then @add += 4; len = 2","          when @joined.start_with?('I') then @add += 1; len = 1","          else","            value = 0","            errors.add(:convert_me, 'I have no idea what you are talking about')","        end","        @joined.slice!(0, len)","      end","      puts(\"i have added a value --> #{@add}\")","    end","    @total += @add","    @total *= @metals","      puts(\"the total is now --> #{@total}\")","    self.credits = @total","  end","","end",""]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":47},"end":{"row":16,"column":48}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":48},"end":{"row":16,"column":49}},"text":"="}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":49},"end":{"row":16,"column":50}},"text":">"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":50},"end":{"row":16,"column":51}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":51},"end":{"row":16,"column":52}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":52},"end":{"row":16,"column":53}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":53},"end":{"row":16,"column":54}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":54},"end":{"row":16,"column":55}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":16,"column":48},"end":{"row":16,"column":55}},"text":"=> true"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":94,"column":12},"end":{"row":94,"column":17}},"text":"value"},{"action":"insertText","range":{"start":{"row":94,"column":12},"end":{"row":94,"column":13}},"text":"@"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":94,"column":13},"end":{"row":94,"column":14}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":94,"column":14},"end":{"row":94,"column":15}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":94,"column":15},"end":{"row":94,"column":16}},"text":"d"}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":27,"column":26},"end":{"row":27,"column":26},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1415633500261,"hash":"de02e42dc6f08025eaffa90e3ee12428a6f81e6f"}